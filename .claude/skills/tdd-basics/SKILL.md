---
name: tdd-basics
description: Guide for Test-Driven Development fundamentals and Red-Green-Refactor cycle. Use when learning TDD concepts, understanding the TDD workflow, or planning test strategies. Language-agnostic principles applicable to any programming language.
---

# TDD Basics

このスキルは、テスト駆動開発（TDD）の基本概念とワークフローを提供します。

## TDDとは

テスト駆動開発（TDD）は、**テストを先に書く**開発手法です。実装前にテストを書くことで、以下のメリットがあります：

- **明確な仕様**: テストが仕様書の役割を果たす
- **高品質なコード**: テスト可能な設計になる
- **リファクタリングの安全性**: テストが変更の安全網になる
- **ドキュメント**: テストが使用例を示す

## Red-Green-Refactorサイクル

TDDの核心は、このシンプルな3ステップのサイクルです：

```
TDD進捗チェックリスト:
- [ ] 🔴 Red: テストを書いて失敗を確認
- [ ] 🟢 Green: 最小限の実装でテストをパス
- [ ] 🔵 Refactor: コードを改善
```

### 🔴 Red: テストを書いて失敗を確認

**目的**: 実装したい機能の仕様をテストコードで表現する

**手順**:
1. 機能の要件を明確にする
2. テストケースを洗い出す（正常系、異常系、境界値）
3. テストコードを書く
4. テストを実行して**失敗することを確認**

**重要**: テストが失敗する理由は「実装がまだない」であるべき。テストコード自体のバグではない。

**例**:
```
✗ add(2, 3) should return 5
  → ReferenceError: add is not defined
```

### 🟢 Green: 最小限の実装でテストをパス

**目的**: テストをパスする最小限のコードを書く

**手順**:
1. テストをパスする最もシンプルな実装を書く
2. テストを実行してパスすることを確認
3. すべてのテストがパスしていることを確認

**重要**: この段階では最適化や汎用化は不要。まずは動くコードを書く。

**例**:
```
✓ add(2, 3) should return 5
```

### 🔵 Refactor: コードを改善

**目的**: テストが通る状態を維持しながらコードの品質を向上させる

**手順**:
1. コードの重複を排除（DRY原則）
2. 変数名や関数名を改善
3. コードの構造を整理
4. 各変更後にテストを実行して確認

**重要**: リファクタリング中は新機能を追加しない。テストは常にパスし続ける。

## TDDワークフロー

実際の開発では、このチェックリストに従って進めます：

```
開発ワークフロー:
- [ ] ステップ1: 仕様を明確化する
- [ ] ステップ2: テスト戦略を立てる
- [ ] ステップ3: Red-Green-Refactorサイクルを繰り返す
- [ ] ステップ4: コードレビューを行う
```

### ステップ1: 仕様を明確化する

実装する機能の要件を明確にします：

- **入力**: どのようなデータを受け取るか
- **処理**: どのような変換・計算を行うか
- **出力**: どのような結果を返すか
- **エッジケース**: 境界値や異常系の動作

### ステップ2: テスト戦略を立てる

どのようなテストが必要かを決定します：

- **単体テスト**: 個々の関数・メソッドの動作
- **統合テスト**: 複数モジュールの連携
- **E2Eテスト**: アプリケーション全体の動作

### ステップ3: Red-Green-Refactorサイクルを繰り返す

各機能について、Red-Green-Refactorサイクルを実行します：

1. **Red**: テストを書く
2. **Green**: 実装する
3. **Refactor**: 改善する
4. 次の機能に進む

### ステップ4: コードレビューを行う

実装が完了したら、以下を確認します：

- [ ] すべてのテストがパスしている
- [ ] カバレッジ目標を達成している
- [ ] コードが読みやすい
- [ ] 重複が排除されている

## TDDのベストプラクティス

### 1. 小さなステップで進める

一度に大きな機能を実装しようとせず、小さな単位で進めます。

**悪い例**: 「ユーザー管理機能」を一度に実装
**良い例**: 「ユーザー作成」→「ユーザー取得」→「ユーザー更新」と段階的に実装

### 2. テストの独立性を保つ

各テストは他のテストに依存せず、独立して実行できるようにします。

### 3. テストファーストを徹底する

実装を書く前に、必ずテストを書きます。「後でテストを書く」は避けましょう。

### 4. リファクタリングを恐れない

テストがあるので、安心してリファクタリングできます。積極的にコードを改善しましょう。

### 5. テストも保守する

テストコードも本番コードと同様に保守します。重複を排除し、読みやすく保ちます。

## テスト戦略

### テストピラミッド

```
       /\
      /E2E\      少数（遅い、高コスト）
     /------\
    /統合テスト\   中程度
   /----------\
  /  単体テスト  \  多数（速い、低コスト）
 /--------------\
```

- **単体テスト**: 最も多く、最も速い
- **統合テスト**: 中程度の数、中程度の速度
- **E2Eテスト**: 最も少なく、最も遅い

### カバレッジ目標

| コードタイプ | 目標カバレッジ |
|------------|--------------|
| ビジネスロジック | 80%以上 |
| ユーティリティ関数 | 90%以上 |
| UIコンポーネント | 70%以上 |

## 次のステップ

### 言語別のテスト実装

具体的なテスト実装については、以下のSkillを参照してください：

- **TypeScript/JavaScript**: [testing-typescript](../testing-typescript/SKILL.md) - Jest/Playwrightの使い方
- **Rust**: [testing-rust](../testing-rust/SKILL.md) - cargo test/nextestの使い方

### CI/CD設定

テストの自動化とデプロイについては：

- **CI/CD**: [ci-cd-setup](../ci-cd-setup/SKILL.md) - GitHub Actionsの設定

## よくある質問

### Q: TDDは必須？

**A**: TDDは推奨されますが、すべてのケースで必須ではありません。新機能開発やバグ修正では効果的ですが、プロトタイピングや実験的なコードでは柔軟に対応してください。

### Q: テストを書く時間がない

**A**: TDDは初期投資は必要ですが、長期的には時間を節約します。バグ修正やリファクタリングの時間が大幅に削減されます。

### Q: レガシーコードにTDDを適用できる？

**A**: 可能です。まず既存コードのテストを書き（特性テスト）、その後リファクタリングしながらTDDを適用していきます。

### Q: 100%のカバレッジを目指すべき？

**A**: いいえ。100%を目指す必要はありません。重要なビジネスロジックを優先し、80-90%を目標にするのが現実的です。

## 参考リソース

- [Test-Driven Development: By Example (Kent Beck)](https://www.amazon.com/Test-Driven-Development-Kent-Beck/dp/0321146530)
- [Growing Object-Oriented Software, Guided by Tests](https://www.amazon.com/Growing-Object-Oriented-Software-Guided-Tests/dp/0321503627)
- [The Art of Unit Testing](https://www.manning.com/books/the-art-of-unit-testing-third-edition)
