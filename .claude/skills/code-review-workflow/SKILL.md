---
name: code-review-workflow
description: Guide for systematic code review process. Use when reviewing code, checking quality, or providing feedback on pull requests. Covers security, performance, testing, and best practices.
---

# Code Review Workflow

このスキルは、体系的なコードレビュープロセスをガイドします。

## レビュー観点チェックリスト

### 1. コード品質

**可読性と保守性**:
- [ ] 変数名・関数名が意図を明確に表現しているか
- [ ] コードの構造が論理的で理解しやすいか
- [ ] 複雑な処理に適切なコメントがあるか
- [ ] マジックナンバーが定数化されているか

**設計原則**:
- [ ] DRY原則（Don't Repeat Yourself）が守られているか
- [ ] SOLID原則が適用されているか
- [ ] 単一責任の原則に従っているか
- [ ] 適切な抽象化レベルか

**命名規則**:
- [ ] プロジェクトの命名規則に従っているか
- [ ] 一貫した命名スタイルか
- [ ] 略語の使用が適切か

### 2. セキュリティ

**入力検証**:
- [ ] すべてのユーザー入力が検証されているか
- [ ] サニタイゼーション処理が適切か
- [ ] 型チェックが行われているか

**認証・認可**:
- [ ] 認証が適切に実装されているか
- [ ] 認可チェックが漏れていないか
- [ ] セッション管理が安全か

**一般的な脆弱性対策**:
- [ ] SQLインジェクション対策
- [ ] XSS（クロスサイトスクリプティング）対策
- [ ] CSRF（クロスサイトリクエストフォージェリ）対策
- [ ] パストラバーサル対策
- [ ] 機密情報のハードコーディングがないか

### 3. パフォーマンス

**計算量**:
- [ ] アルゴリズムの計算量が適切か（O(n), O(n log n)等）
- [ ] 不要なループのネストがないか
- [ ] 早期リターンが活用されているか

**メモリ使用**:
- [ ] メモリリークの可能性がないか
- [ ] 大きなデータ構造の扱いが適切か
- [ ] 不要なオブジェクト生成がないか

**データベース**:
- [ ] N+1問題が発生していないか
- [ ] インデックスが適切に使用されているか
- [ ] クエリが最適化されているか

**キャッシュ**:
- [ ] キャッシュが適切に活用されているか
- [ ] キャッシュの無効化戦略が適切か

### 4. テスト

**テストカバレッジ**:
- [ ] 新規コードに対するテストがあるか
- [ ] カバレッジが目標値を満たしているか（80%以上推奨）
- [ ] 重要なビジネスロジックがテストされているか

**テストの質**:
- [ ] エッジケースがテストされているか
- [ ] 異常系のテストがあるか
- [ ] テストが独立しているか（他のテストに依存していないか）
- [ ] テストが決定的か（実行するたびに同じ結果になるか）

**テストの種類**:
- [ ] 単体テスト（Unit Tests）
- [ ] 統合テスト（Integration Tests）
- [ ] E2Eテスト（End-to-End Tests）

### 5. エラーハンドリング

**エラー処理**:
- [ ] すべてのエラーケースが処理されているか
- [ ] エラーメッセージが適切か
- [ ] エラーログが記録されているか
- [ ] ユーザーフレンドリーなエラーメッセージか

**例外処理**:
- [ ] 例外が適切にキャッチされているか
- [ ] リソースのクリーンアップが行われているか
- [ ] 例外の再スローが適切か

### 6. ドキュメント

**コードコメント**:
- [ ] 複雑なロジックにコメントがあるか
- [ ] WHYを説明するコメントか（WHATではなく）
- [ ] TODOコメントが適切に管理されているか

**API ドキュメント**:
- [ ] 公開APIにドキュメントがあるか
- [ ] パラメータと戻り値が説明されているか
- [ ] 使用例があるか

**プロジェクトドキュメント**:
- [ ] READMEが更新されているか
- [ ] CHANGELOGが更新されているか
- [ ] 破壊的変更が文書化されているか

## レビューコメントのベストプラクティス

### 建設的なフィードバック

**良い例**:
```
この部分は O(n²) の計算量になっています。
ハッシュマップを使うことで O(n) に改善できます。

例:
const map = new Map();
for (const item of items) {
  map.set(item.id, item);
}
```

**悪い例**:
```
このコードは遅い。
```

### 質問形式の活用

**良い例**:
```
この処理は非同期で実行する必要がありますか？
同期処理でも問題ない場合、シンプルにできそうです。
```

### 肯定的なフィードバック

良いコードには積極的にポジティブなコメントを:
```
このエラーハンドリングは非常に丁寧で、ユーザーにとって
分かりやすいメッセージになっていますね！
```

## 自動化ツールの活用

### 静的解析ツール

**TypeScript/JavaScript**:
- ESLint: コードスタイルと潜在的なバグの検出
- Prettier: コードフォーマット
- TypeScript: 型チェック

**Rust**:
- clippy: Rustのリンター
- rustfmt: コードフォーマッター
- cargo check: 型チェック

### セキュリティスキャン

- **npm audit**: npm パッケージの脆弱性チェック
- **cargo audit**: Rust クレートの脆弱性チェック
- **Snyk**: 依存関係の脆弱性スキャン

### テストカバレッジ

- **Jest**: JavaScript/TypeScriptのカバレッジ
- **cargo-llvm-cov**: Rustのカバレッジ

## 言語別のレビューポイント

### TypeScript/JavaScript

**型安全性**:
- [ ] `any`型の使用が最小限か
- [ ] 型アサーションが適切か
- [ ] null/undefinedチェックが適切か

**非同期処理**:
- [ ] Promise/async-awaitが適切に使用されているか
- [ ] エラーハンドリングが適切か
- [ ] 並列処理が適切に実装されているか

### Rust

**所有権とライフタイム**:
- [ ] 所有権の移動が適切か
- [ ] ライフタイムが適切に指定されているか
- [ ] 借用チェッカーのエラーを回避するための不適切な回避策がないか

**エラーハンドリング**:
- [ ] `Result`型が適切に使用されているか
- [ ] `unwrap()`の使用が適切か（本番コードでは避けるべき）
- [ ] `?`演算子が活用されているか

## 関連Skill

- **tdd-basics**: [tdd-basics](../tdd-basics/SKILL.md) - テストファーストの開発
- **testing-typescript**: [testing-typescript](../testing-typescript/SKILL.md) - TypeScriptテスト
- **testing-rust**: [testing-rust](../testing-rust/SKILL.md) - Rustテスト
- **ci-cd-setup**: [ci-cd-setup](../ci-cd-setup/SKILL.md) - 自動化されたレビュー

## トラブルシューティング

### レビューに時間がかかりすぎる

**解決策**:
1. チェックリストを使用して効率化
2. 自動化ツールで機械的なチェックを削減
3. 重要度の高い部分に集中

### レビューコメントが多すぎる

**解決策**:
1. 最も重要な問題に絞る
2. スタイルの問題は自動フォーマッターに任せる
3. 教育的なコメントは別途ドキュメント化

### 意見の相違

**解決策**:
1. プロジェクトの憲法やガイドラインを参照
2. データやベンチマークで判断
3. チーム全体で議論
