# Spec Kit + TDD 統合ワークフロー

本ドキュメントでは、仕様駆動開発（Spec Kit）とテスト駆動開発（TDD）を組み合わせた開発フローについて説明します。このワークフローにより、確実なVibe-Codingを実現できます。

## 概要

Spec Kit + TDD ワークフローは以下の原則に基づいています：

1. **仕様ファースト**: 機能実装前に明確な仕様を作成
2. **テストファースト**: 実装前にテストコードを作成  
3. **段階的実装**: 仕様 → テスト → 実装 → 検証のサイクル
4. **プロジェクト憲法遵守**: 開発原則の一貫した適用

## ワークフローの全体像

```mermaid
graph TD
    A[機能要求] --> B[/specify: 仕様作成]
    B --> C[/clarify: 仕様明確化]
    C --> D[/plan: 実装計画]
    D --> E[/tasks: タスク生成]
    E --> F[/implement: TDD実装]
    F --> G[検証・テスト]
    G --> H{品質OK?}
    H -->|Yes| I[機能完了]
    H -->|No| J[/debug-help: デバッグ]
    J --> F
```

## フェーズ詳細

### フェーズ 0: 仕様作成（Specification）

#### `/specify` コマンド
自然言語の機能説明から正式な仕様を作成します。

```bash
@claude /specify ユーザー登録機能を追加したい。メールアドレスとパスワードで登録でき、重複チェックも行う
```

**出力例:**
- ブランチ作成: `005-user-registration`
- 仕様ファイル: `.specify/specs/005-user-registration/spec.md`

#### `/clarify` コマンド
仕様の曖昧な点を対話的に明確化します。

```bash
@claude /clarify パスワードの複雑性要件は？メール認証は必要？
```

### フェーズ 1: 実装計画（Planning）

#### `/plan` コマンド
仕様から具体的な実装計画を作成します。

```bash
@claude /plan
```

**生成される成果物:**
- `plan.md` - 全体設計と技術選定
- `research.md` - 技術調査結果
- `data-model.md` - データモデル設計
- `contracts/` - API契約定義
- `quickstart.md` - 検証手順

### フェーズ 2: タスク生成（Task Generation）

#### `/tasks` コマンド
実装計画からTDD準拠のタスクリストを生成します。

```bash
@claude /tasks
```

**生成されるタスクの特徴:**
- テスト優先順序（TDD準拠）
- 並列実行可能タスクのマーク `[P]`
- 依存関係の明確化
- ファイルパス指定による具体性

### フェーズ 3: 実装（Implementation）

#### `/implement` コマンド
TDDサイクルに従った実装を実行します。

```bash
@claude /implement
```

**TDDサイクル:**
1. **Red**: テストを書く（失敗する）
2. **Green**: テストを通す最小限の実装
3. **Refactor**: コード改善

### フェーズ 4: 検証・デバッグ

#### `/debug-help` コマンド
実装時のエラー解析とデバッグ支援。

```bash
@claude /debug-help テストが失敗している
```

#### `/code-review` コマンド
コード品質の分析とレビュー。

```bash
@claude /code-review src/models/user.rs
```

## プロジェクト憲法との統合

### 憲法チェック
各フェーズで `/constitution` コマンドにより開発原則への準拠を確認：

```bash
@claude /constitution
```

### 主要原則
1. **ライブラリファースト**: 機能をライブラリとして設計
2. **CLIインターフェース**: すべての機能にCLI提供  
3. **テストファースト**: TDD厳格遵守
4. **統合テスト**: 契約テストとサービス間通信テスト
5. **観測可能性**: ログ・メトリクス・トレーシング

## 専門エージェントとの連携

### 言語・技術別エージェント
特定の技術領域では専門エージェントを活用：

```bash
@claude rust-expert: 所有権エラーを修正してください
@claude web-developer: レスポンシブデザインを実装してください  
@claude security-expert: 脆弱性を検査してください
```

### エージェント選択指針
- **rust-expert**: Rust特有の問題（所有権、async等）
- **web-developer**: フロントエンド・Web API開発
- **mobile-developer**: モバイルアプリ開発
- **devops-engineer**: CI/CD・インフラ設定
- **data-scientist**: データ分析・機械学習
- **security-expert**: セキュリティ監査・脆弱性対応

## ベストプラクティス

### 1. 仕様品質の確保
- 機能要求は具体的に記述
- 受入条件を明確化
- エッジケースも考慮

### 2. テスト戦略
- 契約テスト（API仕様テスト）
- 統合テスト（ユーザーシナリオテスト）
- 単体テスト（ロジック検証）

### 3. 段階的実装
- 最小機能から開始
- 段階的機能追加
- 継続的品質確認

### 4. 品質ゲート
- 各フェーズでの憲法チェック
- コードレビューの実行
- 自動化テストの通過

## トラブルシューティング

### よくある問題と解決策

#### 1. 仕様が曖昧
**問題**: `[NEEDS CLARIFICATION]` マーカーが残る
**解決**: `/clarify` コマンドで対話的明確化

#### 2. テストが複雑すぎる
**問題**: テスト作成が困難
**解決**: 仕様を単純化、段階的実装

#### 3. 実装が憲法違反
**問題**: 複雑性が増しすぎる
**解決**: 設計の見直し、原則回帰

#### 4. 依存関係エラー
**問題**: タスク実行順序の問題
**解決**: 依存関係の再確認、並列実行の見直し

## まとめ

Spec Kit + TDD ワークフローは以下を実現します：

- ✅ **品質確保**: 仕様とテストによる品質担保
- ✅ **開発効率**: 段階的・体系的な開発プロセス
- ✅ **保守性**: 明確な仕様とテストによる保守容易性
- ✅ **拡張性**: モジュラー設計による機能拡張
- ✅ **一貫性**: プロジェクト憲法による開発原則統一

このワークフローにより、確実で効率的なVibe-Codingが可能になります。